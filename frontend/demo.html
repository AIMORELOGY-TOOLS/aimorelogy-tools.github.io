<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®ä¿¡ç™»å½•æ¨¡å— - å®Œæ•´æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .demo-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .demo-card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .login-status {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #07c160;
        }
        
        .status-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .status-content {
            color: #666;
            font-size: 14px;
        }
        
        .user-info {
            background: #e8f5e8;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
        }
        
        .user-info strong {
            color: #07c160;
        }
        
        .logout-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            transition: background 0.3s;
        }
        
        .logout-btn:hover {
            background: #ff3742;
        }
        
        .features-list {
            list-style: none;
            margin-bottom: 20px;
        }
        
        .features-list li {
            padding: 8px 0;
            color: #666;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .features-list li:last-child {
            border-bottom: none;
        }
        
        .features-list li::before {
            content: "âœ…";
            margin-right: 10px;
        }
        
        .code-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .code-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre;
        }
        
        .integration-example {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .api-docs {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .api-endpoint {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #007bff;
        }
        
        .method-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .method-get { background: #28a745; color: white; }
        .method-post { background: #007bff; color: white; }
        
        .github-link {
            display: inline-block;
            background: #333;
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 8px;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        
        .github-link:hover {
            background: #555;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” å¾®ä¿¡ç™»å½•æ¨¡å—</h1>
            <p>åŸºäº Cloudflare Workers çš„å®Œæ•´å¾®ä¿¡æ‰«ç ç™»å½•è§£å†³æ–¹æ¡ˆ</p>
        </div>
        
        <div class="demo-grid">
            <!-- ç™»å½•æ¼”ç¤º -->
            <div class="demo-card">
                <h2>ğŸš€ ç™»å½•æ¼”ç¤º</h2>
                <div class="login-status">
                    <div class="status-title">å½“å‰ç™»å½•çŠ¶æ€</div>
                    <div class="status-content" id="loginStatus">
                        æœªç™»å½• - ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹ç™»å½•
                    </div>
                </div>
                
                <ul class="features-list">
                    <li>å¾®ä¿¡å…¬ä¼—å·æ‰«ç ç™»å½•</li>
                    <li>å®æ—¶çŠ¶æ€æ¨é€</li>
                    <li>å®‰å…¨çš„ä¼šè¯ç®¡ç†</li>
                    <li>å“åº”å¼ç•Œé¢è®¾è®¡</li>
                    <li>æ¨¡å—åŒ–ç»„ä»¶</li>
                </ul>
                
                <!-- å¾®ä¿¡ç™»å½•æŒ‰é’® -->
                <button class="wechat-login-btn" onclick="WechatLogin.open()">
                    <span>å¾®</span>
                    å¼€å§‹å¾®ä¿¡ç™»å½•
                </button>
            </div>
            
            <!-- æŠ€æœ¯ç‰¹æ€§ -->
            <div class="demo-card">
                <h2>âš¡ æŠ€æœ¯ç‰¹æ€§</h2>
                <ul class="features-list">
                    <li>Cloudflare Workers è¾¹ç¼˜è®¡ç®—</li>
                    <li>Durable Objects çŠ¶æ€ç®¡ç†</li>
                    <li>WebSocket å®æ—¶é€šä¿¡</li>
                    <li>è‡ªå®šä¹‰åŸŸåæ”¯æŒ</li>
                    <li>CORS è·¨åŸŸæ”¯æŒ</li>
                    <li>ç§»åŠ¨ç«¯é€‚é…</li>
                    <li>TypeScript ç±»å‹æ”¯æŒ</li>
                    <li>æ¨¡å—åŒ–æ¶æ„è®¾è®¡</li>
                </ul>
            </div>
        </div>
        
        <!-- é›†æˆç¤ºä¾‹ -->
        <div class="integration-example">
            <h2>ğŸ“¦ å¿«é€Ÿé›†æˆ</h2>
            
            <div class="code-section">
                <h3>1. å¼•å…¥ç»„ä»¶</h3>
                <div class="code-block">&lt;!-- åœ¨ HTML ä¸­å¼•å…¥ --&gt;
&lt;script&gt;
    const API_BASE_URL = 'https://aimorelogybackend.site';
&lt;/script&gt;
&lt;script src="wechat-login-component.js"&gt;&lt;/script&gt;</div>
            </div>
            
            <div class="code-section">
                <h3>2. æ·»åŠ ç™»å½•æŒ‰é’®</h3>
                <div class="code-block">&lt;!-- ç™»å½•æŒ‰é’® --&gt;
&lt;button onclick="WechatLogin.open()"&gt;å¾®ä¿¡ç™»å½•&lt;/button&gt;

&lt;!-- æˆ–ä½¿ç”¨å†…ç½®æ ·å¼çš„æŒ‰é’® --&gt;
&lt;button class="wechat-login-btn" onclick="WechatLogin.open()"&gt;
    &lt;span&gt;å¾®&lt;/span&gt;
    å¾®ä¿¡ç™»å½•
&lt;/button&gt;</div>
            </div>
            
            <div class="code-section">
                <h3>3. ç›‘å¬ç™»å½•äº‹ä»¶</h3>
                <div class="code-block">// ç›‘å¬ç™»å½•æˆåŠŸäº‹ä»¶
window.addEventListener('wechatLoginSuccess', function(event) {
    const { token, openid, loginTime } = event.detail;
    console.log('ç™»å½•æˆåŠŸ:', { token, openid, loginTime });
    
    // å¤„ç†ç™»å½•æˆåŠŸé€»è¾‘
    updateUserInterface();
});

// ç›‘å¬é€€å‡ºç™»å½•äº‹ä»¶
window.addEventListener('wechatLogout', function() {
    console.log('ç”¨æˆ·å·²é€€å‡ºç™»å½•');
    
    // å¤„ç†é€€å‡ºç™»å½•é€»è¾‘
    clearUserInterface();
});</div>
            </div>
            
            <div class="code-section">
                <h3>4. æ£€æŸ¥ç™»å½•çŠ¶æ€</h3>
                <div class="code-block">// æ£€æŸ¥å½“å‰ç™»å½•çŠ¶æ€
const status = WechatLogin.checkStatus();

if (status.isLoggedIn) {
    console.log('ç”¨æˆ·å·²ç™»å½•:', status.openid);
    console.log('ç™»å½•Token:', status.token);
} else {
    console.log('ç”¨æˆ·æœªç™»å½•');
}

// æ‰‹åŠ¨é€€å‡ºç™»å½•
WechatLogin.logout();</div>
            </div>
        </div>
        
        <!-- API æ–‡æ¡£ -->
        <div class="api-docs">
            <h2>ğŸ“š API æ–‡æ¡£</h2>
            
            <div class="api-endpoint">
                <span class="method-tag method-post">POST</span>
                <strong>/create_qr</strong>
                <p>åˆ›å»ºå¾®ä¿¡ç™»å½•äºŒç»´ç </p>
                <div class="code-block">// å“åº”ç¤ºä¾‹
{
  "sessionId": "uuid-string",
  "qrUrl": "https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=...",
  "ticket": "ticket-string",
  "expireSeconds": 600
}</div>
            </div>
            
            <div class="api-endpoint">
                <span class="method-tag method-get">GET</span>
                <strong>/poll?id={sessionId}</strong>
                <p>è½®è¯¢ç™»å½•çŠ¶æ€</p>
                <div class="code-block">// å“åº”ç¤ºä¾‹
{
  "status": "scanned", // pending | scanned | success
  "openid": "user-openid",
  "timestamp": 1234567890
}</div>
            </div>
            
            <div class="api-endpoint">
                <span class="method-tag method-post">POST</span>
                <strong>/finalize_login</strong>
                <p>å®Œæˆç™»å½•æµç¨‹</p>
                <div class="code-block">// è¯·æ±‚ä½“
{
  "sessionId": "uuid-string"
}

// å“åº”ç¤ºä¾‹
{
  "success": true,
  "token": "login-token",
  "openid": "user-openid",
  "loginTime": "2024-01-01T00:00:00.000Z"
}</div>
            </div>
            
            <div class="api-endpoint">
                <span class="method-tag method-post">POST</span>
                <strong>/wechat-callback</strong>
                <p>å¾®ä¿¡æœåŠ¡å™¨å›è°ƒæ¥å£ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰</p>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
            <a href="https://github.com/AIMORELOGY-TOOLS/aimorelogy-tools.github.io" class="github-link" target="_blank">
                ğŸ“– æŸ¥çœ‹å®Œæ•´æ–‡æ¡£
            </a>
            <a href="https://github.com/AIMORELOGY-TOOLS/aimorelogy-tools.github.io" class="github-link" target="_blank">
                â­ GitHub æºç 
            </a>
        </div>
    </div>

    <!-- å¼•å…¥å¾®ä¿¡ç™»å½•ç»„ä»¶ -->
    <script>
        // é…ç½®åç«¯ API åœ°å€
        const API_BASE_URL = 'https://aimorelogybackend.site';
    </script>
    <script src="wechat-login-component.js"></script>
    
    <script>
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        window.addEventListener('load', function() {
            updateLoginStatus();
        });
        
        // ç›‘å¬ç™»å½•æˆåŠŸäº‹ä»¶
        window.addEventListener('wechatLoginSuccess', function(event) {
            console.log('ç™»å½•æˆåŠŸ:', event.detail);
            updateLoginStatus();
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            showNotification('ç™»å½•æˆåŠŸï¼', 'success');
        });
        
        // ç›‘å¬é€€å‡ºç™»å½•äº‹ä»¶
        window.addEventListener('wechatLogout', function() {
            console.log('å·²é€€å‡ºç™»å½•');
            updateLoginStatus();
            
            // æ˜¾ç¤ºé€€å‡ºæç¤º
            showNotification('å·²é€€å‡ºç™»å½•', 'info');
        });
        
        // æ›´æ–°ç™»å½•çŠ¶æ€æ˜¾ç¤º
        function updateLoginStatus() {
            const status = WechatLogin.checkStatus();
            const statusElement = document.getElementById('loginStatus');
            
            if (status.isLoggedIn) {
                statusElement.innerHTML = `
                    <div class="user-info">
                        <div><strong>ç™»å½•çŠ¶æ€:</strong> âœ… å·²ç™»å½•</div>
                        <div><strong>OpenID:</strong> ${status.openid}</div>
                        <div><strong>ç™»å½•æ—¶é—´:</strong> ${new Date(status.loginTime).toLocaleString()}</div>
                        <div><strong>Token:</strong> ${status.token.substring(0, 20)}...</div>
                        <button class="logout-btn" onclick="WechatLogin.logout()">é€€å‡ºç™»å½•</button>
                    </div>
                `;
            } else {
                statusElement.textContent = 'âŒ æœªç™»å½• - ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹ç™»å½•';
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#07c160' : type === 'error' ? '#ff4757' : '#007bff'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 10001;
                animation: slideInRight 0.3s ease;
            `;
            notification.textContent = message;
            
            // æ·»åŠ åŠ¨ç”»æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                notification.remove();
                style.remove();
            }, 3000);
        }
    </script>
</body>
</html>